<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Caminho Feliz do OpenID Connect - Reino OIDC</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico"> -->
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">üè∞ Reino OIDC</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">üè† In√≠cio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="personagens.html">üë• Personagens</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            üìñ Hist√≥ria
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="historia_p1.html">Parte I - A Era Sombria</a></li>
                            <li><a class="dropdown-item" href="historia_p2.html">Parte II - A Chegada do OIDC</a></li>
                            <li><a class="dropdown-item" href="historia_p3.html">Parte III - A Nova Era</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="conclusao.html">Conclus√£o</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="mundo_do_conhecimento.html">üåü Conhecimento</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="caminho_feliz.html">‚ú® Caminho Feliz</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="aprendiz.html">üéì Academia</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="glossario.html">üìö Gloss√°rio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="mapas.html">üó∫Ô∏è Mapas</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-success text-white text-center">
                        <h1 class="display-4 mb-0">‚ú® O Caminho Feliz do OpenID Connect</h1>
                        <p class="lead mb-0">Authorization Code Flow - Passo a Passo para o Sucesso</p>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h5><i class="fas fa-info-circle"></i> O que √© o "Caminho Feliz"?</h5>
                            <p class="mb-0">O <strong>Caminho Feliz</strong> (Happy Path) √© quando tudo funciona perfeitamente no fluxo de autentica√ß√£o. √â o cen√°rio ideal onde o usu√°rio consegue fazer login com sucesso, sem erros ou problemas. Vamos acompanhar esta jornada!</p>
                        </div>

                        <!-- Accordion para o fluxo passo a passo -->
                        <div class="accordion" id="caminhoFelizAccordion">
                            
                            <!-- Passo 1 -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="passo1">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1">
                                        <strong>1Ô∏è‚É£ Usu√°rio quer acessar o aplicativo</strong>
                                    </button>
                                </h2>
                                <div id="collapse1" class="accordion-collapse collapse show" data-bs-parent="#caminhoFelizAccordion">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>üë∂ Para Leigos</h5>
                                                <p>Imagine que voc√™ quer entrar no seu aplicativo favorito (como Instagram ou Netflix). Voc√™ clica no bot√£o "Entrar" ou "Login".</p>
                                                <p><strong>Exemplo:</strong> Jo√£o quer ver seus v√≠deos no StreamApp e clica em "Fazer Login".</p>
                                            </div>
                                            <div class="col-md-6">
                                                <h5>üîß Para T√©cnicos</h5>
                                                <p>O usu√°rio acessa uma aplica√ß√£o cliente (relying party) que requer autentica√ß√£o. A aplica√ß√£o n√£o possui credenciais do usu√°rio localmente.</p>
                                                <div class="code-school-box">
                                                    <div class="code-school-header">
                                                        <span>üåê HTTP Request</span>
                                                    </div>
                                                    <pre class="code-school-pre">GET /app/protected-resource
Host: myapp.com
Cookie: (n√£o autenticado)</pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Passo 2 -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="passo2">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2">
                                        <strong>2Ô∏è‚É£ Aplicativo redireciona para o provedor de identidade</strong>
                                    </button>
                                </h2>
                                <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#caminhoFelizAccordion">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>üë∂ Para Leigos</h5>
                                                <p>O aplicativo diz: "Eu n√£o sei quem voc√™ √©, vou te mandar para o Google/Facebook/Microsoft para eles confirmarem sua identidade". √â como mostrar seu RG na portaria de um pr√©dio.</p>
                                                <p><strong>Personagem em a√ß√£o:</strong> O Capit√£o OpenID Connect entra em cena e diz "Vamos ao Provedor de Identidade!"</p>
                                            </div>
                                            <div class="col-md-6">
                                                <h5>üîß Para T√©cnicos</h5>
                                                <p>A aplica√ß√£o cliente redireciona o usu√°rio para o Authorization Server (AS) do provedor de identidade, incluindo par√¢metros PKCE para seguran√ßa.</p>
                                                <div class="code-school-box">
                                                    <div class="code-school-header">
                                                        <span>üîó Authorization Request</span>
                                                    </div>
                                                    <pre class="code-school-pre">GET /auth?
  response_type=code&
  client_id=myapp123&
  redirect_uri=https://myapp.com/callback&
  scope=openid profile email&
  state=random_state_123&
  code_challenge=ABC123...&
  code_challenge_method=S256
Host: identity-provider.com</pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Passo 3 -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="passo3">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3">
                                        <strong>3Ô∏è‚É£ Usu√°rio faz login no provedor</strong>
                                    </button>
                                </h2>
                                <div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#caminhoFelizAccordion">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>üë∂ Para Leigos</h5>
                                                <p>Agora voc√™ est√° na p√°gina do Google (ou outro provedor). Voc√™ digita seu email e senha normalmente, como sempre fez. √â aquela tela que voc√™ j√° conhece!</p>
                                                <p><strong>Exemplo:</strong> Jo√£o digita "joao@gmail.com" e sua senha no Google.</p>
                                            </div>
                                            <div class="col-md-6">
                                                <h5>üîß Para T√©cnicos</h5>
                                                <p>O Authorization Server apresenta interface de autentica√ß√£o. Usu√°rio insere credenciais e o AS valida contra seu banco de usu√°rios.</p>
                                                <div class="code-school-box">
                                                    <div class="code-school-header">
                                                        <span>üîê Login Form</span>
                                                    </div>
                                                    <pre class="code-school-pre">POST /login
Host: identity-provider.com
Content-Type: application/x-www-form-urlencoded

username=user@example.com&
password=securepassword&
session_id=session123</pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Passo 4 -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="passo4">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse4">
                                        <strong>4Ô∏è‚É£ Provedor gera c√≥digo de autoriza√ß√£o</strong>
                                    </button>
                                </h2>
                                <div id="collapse4" class="accordion-collapse collapse" data-bs-parent="#caminhoFelizAccordion">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>üë∂ Para Leigos</h5>
                                                <p>O Google confirma: "Sim, esse √© realmente o Jo√£o!". Ent√£o ele cria uma "nota de autoriza√ß√£o" (como um ticket de estacionamento) que prova que voc√™ √© voc√™ mesmo.</p>
                                                <p><strong>Personagem em a√ß√£o:</strong> O Sergeant Authorization Code aparece carregando o c√≥digo secreto!</p>
                                            </div>
                                            <div class="col-md-6">
                                                <h5>üîß Para T√©cnicos</h5>
                                                <p>Ap√≥s autentica√ß√£o bem-sucedida, o AS gera um authorization code √∫nico e tempor√°rio (v√°lido por ~10 minutos). Este c√≥digo ser√° trocado por tokens.</p>
                                                <div class="code-school-box">
                                                    <div class="code-school-header">
                                                        <span>üé´ Authorization Code</span>
                                                    </div>
                                                    <pre class="code-school-pre">// C√≥digo gerado internamente
authorization_code = "abc123def456..."
expiry = now() + 10_minutes
associated_client = "myapp123"
associated_user = "user@example.com"</pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Passo 5 -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="passo5">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse5">
                                        <strong>5Ô∏è‚É£ Usu√°rio √© redirecionado de volta com o c√≥digo</strong>
                                    </button>
                                </h2>
                                <div id="collapse5" class="accordion-collapse collapse" data-bs-parent="#caminhoFelizAccordion">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>üë∂ Para Leigos</h5>
                                                <p>O Google manda voc√™ de volta para o aplicativo original, mas agora voc√™ est√° carregando a "nota de autoriza√ß√£o". √â como voltar para a portaria do pr√©dio com seu RG carimbado.</p>
                                                <p><strong>Exemplo:</strong> Jo√£o volta para o StreamApp, mas agora com um c√≥digo especial na URL.</p>
                                            </div>
                                            <div class="col-md-6">
                                                <h5>üîß Para T√©cnicos</h5>
                                                <p>O AS redireciona o usu√°rio de volta para a aplica√ß√£o cliente usando a redirect_uri fornecida, incluindo o authorization code e o state para valida√ß√£o.</p>
                                                <div class="code-school-box">
                                                    <div class="code-school-header">
                                                        <span>‚Ü©Ô∏è Redirect Response</span>
                                                    </div>
                                                    <pre class="code-school-pre">HTTP/1.1 302 Found
Location: https://myapp.com/callback?
  code=abc123def456...&
  state=random_state_123</pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Passo 6 -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="passo6">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse6">
                                        <strong>6Ô∏è‚É£ Aplicativo troca o c√≥digo por tokens</strong>
                                    </button>
                                </h2>
                                <div id="collapse6" class="accordion-collapse collapse" data-bs-parent="#caminhoFelizAccordion">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>üë∂ Para Leigos</h5>
                                                <p>O aplicativo pega a "nota de autoriza√ß√£o" e vai at√© o Google nos bastidores (sem voc√™ ver) para trocar por uma "carteirinha de membro" oficial. √â como trocar um voucher por um cart√£o VIP.</p>
                                                <p><strong>Personagens em a√ß√£o:</strong> Access Token e ID Token chegam para a festa!</p>
                                            </div>
                                            <div class="col-md-6">
                                                <h5>üîß Para T√©cnicos</h5>
                                                <p>A aplica√ß√£o cliente faz uma requisi√ß√£o server-to-server para trocar o authorization code por access_token, id_token e refresh_token, usando PKCE para valida√ß√£o.</p>
                                                <div class="code-school-box">
                                                    <div class="code-school-header">
                                                        <span>üîÑ Token Exchange</span>
                                                    </div>
                                                    <pre class="code-school-pre">POST /token
Host: identity-provider.com
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&
code=abc123def456...&
redirect_uri=https://myapp.com/callback&
client_id=myapp123&
code_verifier=xyz789...</pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Passo 7 -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="passo7">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse7">
                                        <strong>7Ô∏è‚É£ Aplicativo recebe os tokens</strong>
                                    </button>
                                </h2>
                                <div id="collapse7" class="accordion-collapse collapse" data-bs-parent="#caminhoFelizAccordion">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>üë∂ Para Leigos</h5>
                                                <p>O Google entrega para o aplicativo tr√™s coisas importantes: uma "chave de acesso" (para usar os recursos), um "documento de identidade" (provando quem voc√™ √©) e uma "chave de renova√ß√£o" (para quando a primeira expirar).</p>
                                            </div>
                                            <div class="col-md-6">
                                                <h5>üîß Para T√©cnicos</h5>
                                                <p>O AS retorna um JSON com access_token (para APIs), id_token (identidade do usu√°rio) e refresh_token (para renova√ß√£o). Tokens s√£o JWTs assinados.</p>
                                                <div class="code-school-box">
                                                    <div class="code-school-header">
                                                        <span>üéüÔ∏è Token Response</span>
                                                    </div>
                                                    <pre class="code-school-pre">{
  "access_token": "eyJhbGciOiJSUzI1NiI...",
  "id_token": "eyJhbGciOiJSUzI1NiI...",
  "refresh_token": "def456ghi789...",
  "token_type": "Bearer",
  "expires_in": 3600,
  "scope": "openid profile email"
}</pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Passo 8 -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="passo8">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse8">
                                        <strong>8Ô∏è‚É£ Sucesso! Usu√°rio est√° logado</strong>
                                    </button>
                                </h2>
                                <div id="collapse8" class="accordion-collapse collapse" data-bs-parent="#caminhoFelizAccordion">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>üë∂ Para Leigos</h5>
                                                <p>üéâ <strong>Parab√©ns!</strong> Voc√™ est√° dentro do aplicativo! Pode ver seus v√≠deos, fotos, ou usar qualquer funcionalidade. O aplicativo agora sabe quem voc√™ √© e o que voc√™ pode fazer.</p>
                                                <p><strong>Exemplo:</strong> Jo√£o est√° vendo seus v√≠deos no StreamApp, e o app mostra "Bem-vindo, Jo√£o!" no canto da tela.</p>
                                            </div>
                                            <div class="col-md-6">
                                                <h5>üîß Para T√©cnicos</h5>
                                                <p>A aplica√ß√£o valida o id_token, extrai informa√ß√µes do usu√°rio e estabelece uma sess√£o local. O access_token fica dispon√≠vel para chamadas de API autorizadas.</p>
                                                <div class="code-school-box">
                                                    <div class="code-school-header">
                                                        <span>‚úÖ Session Established</span>
                                                    </div>
                                                    <pre class="code-school-pre">// ID Token decodificado
{
  "sub": "12345",
  "name": "Jo√£o Silva",
  "email": "joao@gmail.com",
  "iat": 1699027200,
  "exp": 1699030800
}

// Sess√£o local criada
session_id = "sess_abc123"
user_authenticated = true</pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- Resumo Visual -->
                        <div class="mt-5">
                            <div class="card border-success">
                                <div class="card-header bg-success text-white">
                                    <h4 class="mb-0">üéØ Resumo do Caminho Feliz</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row text-center">
                                        <div class="col-md-2">
                                            <div class="p-3">
                                                <div class="display-6">üë§</div>
                                                <small>Usu√°rio<br>clica "Login"</small>
                                            </div>
                                        </div>
                                        <div class="col-md-1">
                                            <div class="p-3">
                                                <div class="display-6">‚û°Ô∏è</div>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="p-3">
                                                <div class="display-6">üîê</div>
                                                <small>Provedor de<br>Identidade</small>
                                            </div>
                                        </div>
                                        <div class="col-md-1">
                                            <div class="p-3">
                                                <div class="display-6">‚û°Ô∏è</div>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="p-3">
                                                <div class="display-6">üé´</div>
                                                <small>C√≥digo de<br>Autoriza√ß√£o</small>
                                            </div>
                                        </div>
                                        <div class="col-md-1">
                                            <div class="p-3">
                                                <div class="display-6">‚û°Ô∏è</div>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="p-3">
                                                <div class="display-6">üéüÔ∏è</div>
                                                <small>Tokens<br>de Acesso</small>
                                            </div>
                                        </div>
                                        <div class="col-md-1">
                                            <div class="p-3">
                                                <div class="display-6">‚úÖ</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center mt-3">
                                        <p class="lead">
                                            <strong>Tempo total:</strong> Geralmente 2-5 segundos<br>
                                            <strong>Seguran√ßa:</strong> M√°xima (PKCE + HTTPS + JWT)<br>
                                            <strong>Experi√™ncia:</strong> Transparente para o usu√°rio
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dicas importantes -->
                        <div class="mt-4">
                            <div class="alert alert-warning">
                                <h5>üí° Dicas Importantes para o Caminho Feliz</h5>
                                <ul class="mb-0">
                                    <li><strong>PKCE √© obrigat√≥rio</strong> - Garante que apenas o app original troque o c√≥digo</li>
                                    <li><strong>State parameter</strong> - Previne ataques CSRF</li>
                                    <li><strong>HTTPS sempre</strong> - Todas as comunica√ß√µes devem ser criptografadas</li>
                                    <li><strong>Tokens t√™m prazo</strong> - Access tokens expiram, use refresh tokens para renovar</li>
                                    <li><strong>Validate tudo</strong> - Sempre valide signatures dos JWTs e par√¢metros recebidos</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Navega√ß√£o -->
                        <div class="text-center mt-4">
                            <a href="mundo_do_conhecimento.html" class="btn btn-primary me-2">
                                ‚¨ÖÔ∏è Voltar ao Conhecimento
                            </a>
                            <a href="glossario.html" class="btn btn-info">
                                üìö Consultar Gloss√°rio
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3 mt-5">
        <div class="container">
            <p>&copy; 2025 Reino OIDC - Educa√ß√£o em OAuth 2.1 e OpenID Connect</p>
            <p><small>Projeto educativo open source - <a href="https://github.com/chmulato/reino_oidc" class="text-info">GitHub</a></small></p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>